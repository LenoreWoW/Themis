{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{Box,CircularProgress,Alert}from'@mui/material';import{useAuth}from'../context/AuthContext';import{useTranslation}from'react-i18next';import api from'../services/api';import{UserRole}from'../types';import LegacyProjectForm from'../components/Project/LegacyProjectForm';import{jsx as _jsx}from\"react/jsx-runtime\";const LegacyProjectPage=()=>{const{token,user}=useAuth();const{t}=useTranslation();const navigate=useNavigate();const[departments,setDepartments]=useState([]);const[users,setUsers]=useState([]);const[isLoading,setIsLoading]=useState(true);const[error,setError]=useState(null);// Check if user has appropriate role (SUB_PMO, MAIN_PMO, or ADMIN)\nconst hasPermission=(user===null||user===void 0?void 0:user.role)===UserRole.SUB_PMO||(user===null||user===void 0?void 0:user.role)===UserRole.MAIN_PMO||(user===null||user===void 0?void 0:user.role)===UserRole.ADMIN;useEffect(()=>{// Redirect if user doesn't have permission\nif(!hasPermission){navigate('/dashboard');return;}const fetchData=async()=>{setIsLoading(true);setError(null);try{// Fetch departments\nconst departmentsResponse=await api.departments.getAllDepartments(token||'');if(departmentsResponse.data){setDepartments(departmentsResponse.data);}// Fetch users\nconst usersResponse=await api.users.getAllUsers(token||'');if(usersResponse.data){setUsers(usersResponse.data);}}catch(err){console.error('Error fetching data:',err);setError('An error occurred while fetching required data. Please try again later.');}finally{setIsLoading(false);}};fetchData();},[hasPermission,navigate,token]);const handleCancel=()=>{navigate('/projects');};// Show loading spinner while data is being fetched\nif(isLoading){return/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',alignItems:'center',height:'100vh'},children:/*#__PURE__*/_jsx(CircularProgress,{})});}// Show error message if data fetching failed\nif(error){return/*#__PURE__*/_jsx(Box,{sx:{p:3},children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:error})});}// Show permission error if user is not authorized\nif(!hasPermission){return/*#__PURE__*/_jsx(Box,{sx:{p:3},children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:\"You do not have permission to access this page.\"})});}return/*#__PURE__*/_jsx(LegacyProjectForm,{departments:departments,users:users,onCancel:handleCancel});};export default LegacyProjectPage;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","Box","CircularProgress","Alert","useAuth","useTranslation","api","UserRole","LegacyProjectForm","jsx","_jsx","LegacyProjectPage","token","user","t","navigate","departments","setDepartments","users","setUsers","isLoading","setIsLoading","error","setError","hasPermission","role","SUB_PMO","MAIN_PMO","ADMIN","fetchData","departmentsResponse","getAllDepartments","data","usersResponse","getAllUsers","err","console","handleCancel","sx","display","justifyContent","alignItems","height","children","p","severity","onCancel"],"sources":["/Users/hassanalsahli/Desktop/Themis/themis-client-final/src/pages/LegacyProjectPage.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Box, CircularProgress, Typography, Alert, Paper } from '@mui/material';\nimport { useAuth } from '../context/AuthContext';\nimport { useTranslation } from 'react-i18next';\nimport api from '../services/api';\nimport { Department, User, UserRole } from '../types';\nimport LegacyProjectForm from '../components/Project/LegacyProjectForm';\n\nconst LegacyProjectPage: React.FC = () => {\n  const { token, user } = useAuth();\n  const { t } = useTranslation();\n  const navigate = useNavigate();\n  const [departments, setDepartments] = useState<Department[]>([]);\n  const [users, setUsers] = useState<User[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Check if user has appropriate role (SUB_PMO, MAIN_PMO, or ADMIN)\n  const hasPermission = user?.role === UserRole.SUB_PMO || \n                       user?.role === UserRole.MAIN_PMO || \n                       user?.role === UserRole.ADMIN;\n\n  useEffect(() => {\n    // Redirect if user doesn't have permission\n    if (!hasPermission) {\n      navigate('/dashboard');\n      return;\n    }\n\n    const fetchData = async () => {\n      setIsLoading(true);\n      setError(null);\n      \n      try {\n        // Fetch departments\n        const departmentsResponse = await api.departments.getAllDepartments(token || '');\n        if (departmentsResponse.data) {\n          setDepartments(departmentsResponse.data);\n        }\n        \n        // Fetch users\n        const usersResponse = await api.users.getAllUsers(token || '');\n        if (usersResponse.data) {\n          setUsers(usersResponse.data);\n        }\n      } catch (err) {\n        console.error('Error fetching data:', err);\n        setError('An error occurred while fetching required data. Please try again later.');\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    \n    fetchData();\n  }, [hasPermission, navigate, token]);\n\n  const handleCancel = () => {\n    navigate('/projects');\n  };\n\n  // Show loading spinner while data is being fetched\n  if (isLoading) {\n    return (\n      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>\n        <CircularProgress />\n      </Box>\n    );\n  }\n\n  // Show error message if data fetching failed\n  if (error) {\n    return (\n      <Box sx={{ p: 3 }}>\n        <Alert severity=\"error\">{error}</Alert>\n      </Box>\n    );\n  }\n\n  // Show permission error if user is not authorized\n  if (!hasPermission) {\n    return (\n      <Box sx={{ p: 3 }}>\n        <Alert severity=\"error\">\n          You do not have permission to access this page.\n        </Alert>\n      </Box>\n    );\n  }\n\n  return (\n    <LegacyProjectForm\n      departments={departments}\n      users={users}\n      onCancel={handleCancel}\n    />\n  );\n};\n\nexport default LegacyProjectPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}